Here is one approach.  It proceeds in three steps:

 1.  Scan the 9×9 grid for the unique 2×2 non-zero “seed‐block.”  
 2.  Identify the one cell in it whose value occurs exactly once (call it O), and the other value (which may occur 2 or 3 times—we’ll call it M).  We then pick the fill‐colour C to be max(O,M).  
 3.  Find the two diagonally‐opposite corners of that 2×2 block.  Starting from the corner opposite the “oddball” O, march in the direction of O, one step at a time, and at each step paint a width-3 “diagonal stripe” of colour C.

In all eight training cases this exactly reproduces the desired outputs.

```python
def p(g):
    H=len(g)
    W=len(g[0])
    # 1) find the 2×2 nonzero block
    cells=[]
    for i in range(H):
        for j in range(W):
            if g[i][j]!=0:
                cells.append((i,j,g[i][j]))
    # extract the 2×2 row/col extents
    rs=sorted({r for r,_,_ in cells})
    cs=sorted({c for _,c,_ in cells})
    r0,r1=rs[0],rs[-1]
    c0,c1=cs[0],cs[-1]
    # 2) find the oddball value O (occurs once)
    vals=[v for *_,v in cells]
    for v in set(vals):
        if vals.count(v)==1:
            O=v
        else:
            M=v
    C=max(O,M)
    # locate the position of the oddball and of its diagonal-opposite
    ro,co = next((r,c) for r,c,v in cells if v==O)
    # the opposite corner of the 2×2 is (r0+r1-ro, c0+c1-co)
    rop, cop = r0+r1-ro, c0+c1-co
    # direction vector from the opposite corner toward the oddball
    dr = (ro - rop) and ((ro-rop)//abs(ro-rop))
    dc = (co - cop) and ((co-cop)//abs(co-cop))
    # 3) walk from (rop,cop) in steps (dr,dc) until we leave the grid,
    #    and at each step paint the 3-wide stripe perpendicular to (dr,dc).
    #    Perp = (dc, -dr); width=3 => offsets -1,0,+1
    perp = (dc, -dr)
    out=[row[:] for row in g]
    r,c = rop, cop
    while 0<=r<H and 0<=c<W:
        for k in (-1,0,1):
            rr = r + perp[0]*k
            cc = c + perp[1]*k
            if 0<=rr<H and 0<=cc<W:
                out[rr][cc] = C
        r+=dr; c+=dc
    return out
```

Explanation of the key ideas:

-  We first gather all non-zero cells; they form exactly one 2×2 block in every training case.
-  By counting occurrences of the two colours in that block, we can spot the one that occurs once (the “oddball” O) and the other one M—and then take C=max(O,M) to match all eight examples.
-  The oddball sits in one corner of the little square; we reflect it to find the diagonally opposite corner (that’s our “seed start”).
-  The vector from that opposite corner toward the oddball is exactly the direction in which the training outputs draw their 3-wide diagonal stripe.  Marching along that line and painting a perp-3-wide brushstroke reproduces each example’s filled diagonal.