Here’s a fully general one‐pass solution (no extra imports, only a handful of very short `val_…` names, and no unnecessary line‐breaks).  It detects whether the band of 5’s is “horizontal” or “vertical,” copies it into a fresh output grid, then for each non‐zero/non‐5 cell shoots a single 5 out to the nearest band‐edge cell outside the band:

```python
def p(g):
 m,n=len(g),len(g[0])
 val_zs=[(i,j) for i in range(m) for j in range(n) if g[i][j]==5]
 val_r0,val_r1=min(i for i,j in val_zs),max(i for i,j in val_zs)
 val_c0,val_c1=min(j for i,j in val_zs),max(j for i,j in val_zs)
 R=[[0]*n for _ in range(m)]
 # copy original 5‐band
 for i in range(val_r0,val_r1+1):
  for j in range(val_c0,val_c1+1): R[i][j]=5
 hor = (val_r1-val_r0>val_c1-val_c0)
 # for every non‐0/non‐5 cell, shoot one 5 to the nearest band boundary
 for i in range(m):
  for j in range(n):
   v=g[i][j]
   if v and v!=5:
    if hor:
     if i<val_r0: R[val_r0-1][j]=5
     if i>val_r1: R[val_r1+1][j]=5
    else:
     if j<val_c0: R[i][val_c0-1]=5
     if j>val_c1: R[i][val_c1+1]=5
 return R
```

Explanation of the key steps:

1. **Locate the 5‐band**  
   We scan all cells and collect the (i,j) of every `5` into `val_zs`.  From that we extract  
   ```python
   val_r0 = min(i for i,_ in val_zs)
   val_r1 = max(i for i,_ in val_zs)
   val_c0 = min(j for _,j in val_zs)
   val_c1 = max(j for _,j in val_zs)
   ```
   This gives the tight bounding rectangle of the 5’s.

2. **Decide orientation**  
   If the band is “longer” in rows than in columns, we treat it as a horizontal stripe (`hor=True`), otherwise a vertical stripe.

3. **Flush the band into a fresh grid**  
   We build `R` all zeros, then copy every cell inside that rectangle to `5`.

4. **For each input marker (non‐zero, non‐5), project one 5**  
   - If the band is horizontal: any cell above it (`i<val_r0`) produces a 5 at `(val_r0-1, j)`; any cell below (`i>val_r1`) at `(val_r1+1, j)`.  
   - If the band is vertical: any cell to the left (`j<val_c0`) produces `(i, val_c0-1)`; any to the right (`j>val_c1`) at `(i, val_c1+1)`.  

All other cells remain 0.  This exactly reproduces the behavior in all of the examples.