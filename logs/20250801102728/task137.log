```python
def p(g):
    n=len(g)
    L=[] 
    for i,r in enumerate(g):
        for j,v in enumerate(r):
            if v:
                L.append((i,j))
                c=v
    xs=sorted({i for i,j in L})
    ys=sorted({j for i,j in L})
    s=max(xs[1]-xs[0],xs[-1]-xs[-2],ys[1]-ys[0],ys[-1]-ys[-2])
    r0=xs[0]%s; c0=ys[0]%s
    R=range(r0,n,s); C=range(c0,n,s)
    h=[[0]*n for _ in range(n)]
    for r in R: h[r]=[c]*n
    for i in range(n):
        for j in C: h[i][j]=c
    L=sorted(L)
    for (a,b),(x,y) in zip(L,L[1:]):
        for k in range(min(a,x),max(a,x)+1): h[k][b]=c
        for k in range(min(b,y),max(b,y)+1): h[x][k]=c
    return h
```