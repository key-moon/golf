p=lambda g,c=15,d=8,t=[0]*9:-c*g or p([t:=(l:=0)or[l:=v and[v|l|w|8//v*(d:=d*2),(v>0)+(min(t:=sum(g,[]),key=t.count)==v)][c<1]for v,w in zip(s,[0]+t)]for s in zip(*g)][::-1],c-1)