A=enumerate
def p(g):y,x,c=zip(*[(i,j,v)for(i,s)in A(g)for(j,v)in A(s)if v]);d=3+1%len({*c[:-9]});B=range(d);k=-d*d;l=(y[k-1]-y[0]+1)//d;return[[g[i*l+y[0]][j*l+min(x[:k])]and g[y[k]+i][x[k]+j]for j in B]for i in B]