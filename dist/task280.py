p=lambda g,c=-3,E=enumerate:c*g or p([*zip(*[g:=[[t,[t[j]]*j+[*t[j:]]][s[j-1]<all([*s[j:],0][:abs(i-k)+1])<v<3]for k,t in E(g)]for i,s in E(g)for j,v in E(s)][-1][::-1])],c+1)