```python
def p(g):
 d={}
 for y,R in enumerate(g):
  for x,c in enumerate(R):
   if c:d.setdefault(c,[]).append([y,x])
 q=[];v=[]
 for k,ps in d.items():
  ys=[i for i,_ in ps];xs=[j for _,j in ps]
  i0,j0=min(ys),min(xs);h=max(ys)-i0+1;w=max(xs)-j0+1
  if h>1and w>1:c,yy,xx,H,W=k,i0,j0,h,w
  elif h==1:q.append((i0,k))
  else:v.append((j0,k))
 q.sort();v.sort()
 t=q[0][1];b=q[-1][1];l=v[0][1];r=v[-1][1]
 return [[0]+[t]*W+[0]]+[[l]+[c if [i+yy,j+xx]in d[c]else 0 for j in range(W)]for i in range(H)]+[[0]+[b]*W+[0]]
```