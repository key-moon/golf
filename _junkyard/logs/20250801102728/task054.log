```python
def p(g):
 d={}
 for r in g:
  for x in r:d[x]=d.get(x,0)+1
 u=sorted(d);b=u[0];t=u[-1]
 bg=b if d[b]>d[t]else t
 rg=u[1]if bg==t else u[-2]
 m=set(u)-{bg,rg}
 H,W=len(g),len(g[0])
 r0,r1,H0,H1=H,-1,W,-1
 for i in range(H):
  for j in range(W):
   if g[i][j]in m:
    r0=min(r0,i);r1=max(r1,i)
    H0=min(H0,j);H1=max(H1,j)
 h,r= r1-r0+1, H1-H0+1
 mp=[(i,j,g[r0+i][H0+j])for i in range(h)for j in range(r)if g[r0+i][H0+j]in m]
 for Y in range(H-h+1):
  for X in range(W-r+1):
   if all(g[Y+i][X+j]==rg for i,j,_ in mp):
    for i,j,v in mp:g[Y+i][X+j]=v
 return g
```