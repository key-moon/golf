from collections import Counter,deque
def p(I,_=range):
 if not I or not I[0]:return[]
 n={};[n.__setitem__(A,n.get(A,0)+1)for B in I for A in B];k=max(n,key=n.get);D,E=len(I),len(I[0]);U=[[0]*E for A in _(D)];o=[];q=[(-1,-1),(-1,0),(-1,1),(0,-1),(0,1),(1,-1),(1,0),(1,1)]
 for F in _(D):
  for G in _(E):
   if U[F][G]or I[F][G]==k:continue
   d=deque([(F,G)]);U[F][G]=1;l=[]
   while d:Y,j=d.popleft();l.append((I[Y][j],(Y,j)));[d.append((A,B))or U[A].__setitem__(B,1)for(r,F)in q for(A,B)in[(Y+r,j+F)]if 0<=A<D and 0<=B<E and not U[A][B]and I[A][B]!=k]
   o.append(l)
 if not o:return I
 o.sort(key=lambda j:len({A for(A,B)in j}),reverse=1);m=o[0];u=lambda f:set()if not f else{(A,(B-min(A for(B,(A,r))in f),r-min(A for(B,(r,A))in f)))for(A,(B,r))in f};r=Counter(A for(A,B)in m);n=max(r.items(),key=lambda l:(l[1],-l[0]))[0];o=[]
 for W in(1,2,3):
  b={(A,(B*W+D,r*W+E))for(A,(B,r))in u(m)for D in _(W)for E in _(W)};j={(A,B)for(A,B)in b if A!=n};d=set();k=set()
  if j:
   k={(A,B)for(r,(A,B))in j};N,a=[A for(A,B)in k],[A for(B,A)in k];A,B,r,K=min(N)-1,min(a)-1,max(N)+1,max(a)+1;h={(A,B)for A in _(A,r+1)}|{(A,K)for A in _(A,r+1)}|{(A,B)for B in _(B,K+1)}|{(r,A)for A in _(B,K+1)};e=j|{(0,A)for A in h};g=u(e);z,j=[A for(B,(A,r))in g],[A for(B,(r,A))in g];h,q=max(z)+1,max(j)+1
   for A in _(-h+1,D):
    for B in _(-q+1,E):
     r=1;h=0
     for(Q,(F,G))in g:
      l,a=A+F,B+G
      if 0<=l<D and 0<=a<E:h=1;r=r and I[l][a]==Q
      else:r=r and Q==0
     if r and h:d.add((A,B))
  if not d:
   j={(A,B)for(A,B)in b if A==n}
   if not j:continue
   k={(A,B)for(r,(A,B))in j};N,a=[A for(A,B)in k],[A for(B,A)in k];A,B,r,K=min(N)-1,min(a)-1,max(N)+1,max(a)+1;h={(A,B)for A in _(A,r+1)}|{(A,K)for A in _(A,r+1)}|{(A,B)for B in _(B,K+1)}|{(r,A)for A in _(B,K+1)};e=j|{(0,A)for A in h};g=u(e);z,j=[A for(B,(A,r))in g],[A for(B,(r,A))in g];h,q=max(z)+1,max(j)+1
   for A in _(-h+1,D):
    for B in _(-q+1,E):
     r=1;h=0
     for(Q,(F,G))in g:
      l,a=A+F,B+G
      if 0<=l<D and 0<=a<E:h=1;r=r and I[l][a]==Q
      else:r=r and Q==0
     if r and h:d.add((A,B))
  if not d:continue
  h,t=min(A for(A,B)in k),min(A for(B,A)in k)
  for(d,i)in d:e,p=d-h+1,i-t+1;o.append({(A,(B+e,r+p))for(A,(B,r))in b})
 m=[list(A)for A in I];[m[A].__setitem__(B,r)for(r,(A,B))in set().union(*o)if 0<=A<D and 0<=B<E];return m