_A=False
ZERO=0
def _vperiod_grid(G):
	A,F=len(G),len(G[0])
	for B in range(1,A):
		C=True
		for D in range(B,A):
			for E in range(F):
				if G[D][E]!=G[D-B][E]:C=_A;break
			if not C:break
		if C:return B
	return A
def _hperiod_grid(G):
	F,A=len(G),len(G[0])
	for B in range(1,A):
		C=True
		for D in range(B,A):
			for E in range(F):
				if G[E][D]!=G[E][D-B]:C=_A;break
			if not C:break
		if C:return B
	return A
def _crop(I,r1,c1,r2,c2):return tuple(tuple(I[A][c1:c2+1])for A in range(r1,r2+1))
def _hsplit(I,n):
	A,F=len(I),len(I[0]);B=A//n;G=1 if A%n!=0 else 0;D=[]
	for E in range(n):
		C=B*E+E*G
		if C+B<=A:D.append(_crop(I,C,0,C+B-1,F-1))
	return D
def _vsplit(I,n):
	F,A=len(I),len(I[0]);B=A//n;G=1 if A%n!=0 else 0;D=[]
	for E in range(n):
		C=B*E+E*G
		if C+B<=A:D.append(_crop(I,0,C,F-1,C+B-1))
	return D
def _palette(G):
	A=set()
	for B in G:A.update(B)
	return A
def solve_f9012d9b(I):
	j='H';i='V';B=None;H,M=len(I),len(I[0]);k=[(I[A][B],(A,B))for A in range(H)for B in range(M)if I[A][B]!=ZERO];E=[(A,B)for A in range(H)for B in range(M)if I[A][B]==ZERO];A=C=J=N=B
	if E:A=min(A for(A,B)in E);J=max(A for(A,B)in E);C=min(A for(B,A)in E);N=max(A for(B,A)in E);F=J-A+1;D=N-C+1
	R=B
	for a in range(2,H+1):
		for K in _hsplit(I,a):
			if ZERO not in _palette(K):
				if R is B or len(K)>len(R):R=K
	W=B;l=B
	for a in range(2,M+1):
		for K in _vsplit(I,a):
			if ZERO not in _palette(K):
				t=len(K[0]);u=_hperiod_grid(K);v=len(_palette(K));m=t,1 if u>1 else 0,v
				if W is B or m>l:W=K;l=m
	if R is B:X=_hsplit(I,2);R=X[0]if X else I
	if W is B:X=_vsplit(I,2);W=X[0]if X else I
	P=_vperiod_grid(R);G=_hperiod_grid(W)
	if E:
		def n(seq):
			A=seq;B=len(A)
			for C in range(1,B):
				D=True
				for E in range(C,B):
					if A[E]!=A[E-C]:D=_A;break
				if D:return C
			return B
		S=B
		for L in(A-1,J+1):
			if 0<=L<H and ZERO not in I[L]:
				Q=n(I[L])
				if Q>1:S=Q if S is B else min(S,Q)
		if S and S>1:G=S
		else:
			T=B
			for L in range(H):
				if ZERO not in I[L]:
					w=len(set(I[L]))
					if w>1:
						Q=n(I[L])
						if Q>1:T=Q if T is B else min(T,Q)
			if T and D%G!=0 and D%T==0:G=T
		def x(rr,cc):
			if rr<0 or cc<0 or rr+F>H or cc+D>M:return
			A=_crop(I,rr,cc,rr+F-1,cc+D-1);return A if ZERO not in _palette(A)else B
		b=[]
		if not(F==1 and D==1):
			for(L,y,z)in((A+P,C,i),(A-P,C,i),(A,C+G,j),(A,C-G,j)):
				o=x(L,y)
				if o is not B:b.append((o,z))
		if b:
			def A0(P):
				L=0
				for G in range(F):
					for K in range(D):
						T,U=A+G,C+K;V=P[G][K]
						for(O,Q)in((-1,0),(1,0),(0,-1),(0,1)):
							B,E=T+O,U+Q
							if 0<=B<H and 0<=E<M:
								if A<=B<=J and C<=E<=N:continue
								if I[B][E]!=ZERO:
									R=G+O;S=K+Q
									if 0<=R<F and 0<=S<D:
										if P[R][S]==I[B][E]:L+=1
				return L
			def A1(P):
				G=0
				for B in range(H-F+1):
					for E in range(M-D+1):
						if B==A and E==C:continue
						J=_crop(I,B,E,B+F-1,E+D-1)
						if ZERO in _palette(J):continue
						if J==P:G+=1
				return G
			p=j if G>P else i if P>G else B
			def A2(dirflag):return 1 if p and dirflag==p else 0
			A3,AB=max(b,key=lambda t:(A2(t[1]),A0(t[0]),A1(t[0])));return A3
	q={(A,B)for A in(-1,0,1)for B in(-1,0,1)if(A,B)!=(0,0)};A4={(A+C,B+D)for(A,B)in q for(C,D)in q};c=sorted(((A*P,B*G)for(A,B)in A4),key=lambda t:(abs(t[0])+abs(t[1]),t))
	if E:
		A=min(A for(A,B)in E);J=max(A for(A,B)in E);C=min(A for(B,A)in E);N=max(A for(B,A)in E);F=J-A+1;D=N-C+1;O={}
		for U in range(A,J+1):
			for V in range(C,N+1):
				d=B
				for(A5,A6)in((0,G),(0,-G),(P,0),(-P,0)):
					e,f=U+A5,V+A6
					if 0<=e<H and 0<=f<M and I[e][f]!=ZERO:d=I[e][f];break
				if d is not B:O[U,V]=d
		if len(O)==F*D:return tuple(tuple(O[A+B,C+D]for D in range(D))for B in range(F))
		O={};g=0,-G;A7=([g]if g not in c else[])+[A for A in c if A!=g]
		for(A8,A9)in A7:
			for(h,(Y,Z))in k:
				U,V=Y+A8,Z+A9
				if A<=U<=J and C<=V<=N:
					if(U,V)not in O:O[U,V]=h
		if len(O)==F*D:return tuple(tuple(O[A+B,C+D]for D in range(D))for B in range(F))
	AA=[(C,(D+A,E+B))for(A,B)in c for(C,(D,E))in k];r=[list(A)for A in I]
	for(h,(Y,Z))in AA:
		if 0<=Y<H and 0<=Z<M:r[Y][Z]=h
	s=tuple(tuple(A)for A in r)
	if not E:return s
	return _crop(s,A,C,J,N)
def p(g):
	try:B=tuple(tuple(A)for A in g);A=solve_f9012d9b(B);return[list(A)for A in A]if isinstance(A,tuple)else A
	except Exception:return[list(A)for A in g]