R=range
L=len
def p(a):
    n,m=L(a),L(a[0]);o=[[0]*m for _ in R(n)];v=[[0]*m for _ in R(n)]
    from collections import deque,Counter
    for i in R(n):
        for j in R(m):
            if a[i][j] and not v[i][j]:
                q=deque([(i,j)]);v[i][j]=1;P=[];cr=Counter()
                while q:
                    r,c=q.popleft();P.append((r,c));cr[a[r][c]]+=1
                    for dr,dc in((1,0),(-1,0),(0,1),(0,-1)):
                        x,y=r+dr,c+dc
                        if 0<=x<n and 0<=y<m and a[x][y] and not v[x][y]:v[x][y]=1;q.append((x,y))
                oc,ic=[k for k,_ in cr.most_common(2)]
                S=[(r,c) for r,c in P if a[r][c]==ic]
                r0=min(r for r,_ in S);c0=min(c for _,c in S);l=max(r for r,_ in S)-r0+1
                for r in R(r0-l-1,r0+2*l+1):
                    for c in R(c0-l-1,c0+2*l+1):
                        if (r<r0-1 or r>r0+l)and(c<c0-1 or c>c0+l):continue
                        o[r][c]=oc
                for r in R(r0-1,r0+l+1):
                    for c in R(c0-1,c0+l+1):o[r][c]=ic
                for r in R(r0,r0+l):
                    for c in R(c0,c0+l):o[r][c]=oc
    return o