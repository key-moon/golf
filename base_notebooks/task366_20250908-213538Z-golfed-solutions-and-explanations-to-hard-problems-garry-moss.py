# def p(g):A=range;B=len;D=sorted;F=lambda q:D(set(c:=sum(q,[])),key=c.count);I=[*map(list,(g,zip(*g))[R:=B(g)>B(g[0])])];h,w=B(I),B(I[0])//2;T,S=D([[r[:w]for r in I],[r[w:]for r in I]],key=lambda q:B(F(q)));f,b=F(S)[-2:];z=F(T)[-1];[exec('for r in S[y:y+H]:r[x:x+W]=[b]*W')or[all(T[u+j][v:v+W]==[(m,z)[m==f]for m in t[j]]for j in A(H))and exec('for j in A(H):T[u+j][v:v+W]=t[j]')for u in A(h-H+1)for v in A(w-W+1)]for n in[3,2,1]for y in A(h)for x in A(w)for H in A(h-y,0,-1)for W in A(w-x,0,-1)if b not in(c:=sum(t:=[r[x:x+W]for r in S[y:y+H]],[]))and H*W-c.count(f)==n];return(T,[*zip(*T)])[R]
def p(r):g=len(r)>len(r[0]);n=[*map(list,(r,zip(*r))[g])];f,o=len(n),len(n[0])>>1;i,r=sorted([[r[:o]for r in n],[r[o:]for r in n]],key=lambda r:len(set(sum(r,[]))));y,a=sorted(set(p:=sum(r,[])),key=p.count)[-2:];u=max(set(p:=sum(i,[])),key=p.count);[exec('for r in r[t:t+e]:r[n:n+s]=[a]*s')or[all(i[t+a][n:n+s]==[(a,u)[a==y]for a in k[a]]for a in range(e))and exec('for a in range(e):i[t+a][n:n+s]=k[a]')for t in range(f-e+1)for n in range(o-s+1)]for g in range(3,0,-1)for t in range(f)for n in range(o)for e in range(f-t,0,-1)for s in range(o-n,0,-1)if a not in(p:=sum(k:=[r[n:n+s]for r in r[t:t+e]],[]))and e*s-p.count(y)==g];return(i,[*zip(*i)])[g]