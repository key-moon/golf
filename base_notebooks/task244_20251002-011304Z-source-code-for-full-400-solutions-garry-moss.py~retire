def p(d,z=range):i,n=len(d),len(d[0]);r=[-1]+[r for r in z(i)if len({*d[r]})==1]+[i];r=[-1]+[r for r in z(n)if len({d[i][r]for i in z(i)})==1]+[n];r=[[d[i+1][r+1]for(r,n)in zip(r,r[1:])if r+1<n-1]for(i,n)in zip(r,r[1:])if i+1<n-1];return[r[::-1]for r in r]