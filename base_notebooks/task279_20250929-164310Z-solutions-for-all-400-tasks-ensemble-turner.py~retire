from collections import deque
def p(g,f=range):
 E,F=len(g),len(g[0]);G=[[0]*F for A in f(E)];K={}
 for H in f(E):
  for I in f(F):
   if not G[H][I]:
    s=g[H][I];L=deque([(H,I)]);G[H][I]=1;T=[]
    while L:
     A,B=L.popleft();T.append((A,B))
     for(R,N)in((1,0),(-1,0),(0,1),(0,-1)):
      C,D=A+R,B+N
      if 0<=C<E and 0<=D<F and not G[C][D]and g[C][D]==s:G[C][D]=1;L.append((C,D))
    K.setdefault(s,[]).append(set(T))
 R=[A for A in K.get(9,[])if not any(A==0 or B==0 or A==E-1or B==F-1for(A,B)in A)];S=set()
 for J in R:S|=J
 T=[A[:]for A in g];t=K.get(1,[])
 if t and R:
  o=S
  for J in t:
   O=False
   for(A,B)in J:
    for(R,N)in((1,0),(-1,0),(0,1),(0,-1)):
     if(A+R,B+N)in o:O=True;break
    if O:break
   if O:
    for(A,B)in J:T[A][B]=8
 return T
