X=lambda g:list(zip(*g[::-1]))
def p(g,L=len,N=range):
 T=[A[:]for A in g]
 for h in N(4):
  g=X(g);T=[list(A)for A in X(T)];E,D=L(g),L(g[0]);s=[(A,B)for A in N(E)for B in N(D)if g[A][B]==1]
  if s:
   e,o,J,K=min(A for(A,B)in s),max(A for(A,B)in s),min(A for(B,A)in s),max(A for(B,A)in s)
   for A in N(E-1):
    for B in N(D-2):
     G=[B for B in N(D)if T[A][B]>0]
     if G and L(G)>3:
      if g[A][B]==1and g[A][B+2]==1:T[A][B+1]=2
      if g[A][B]==1and g[A+1][B+1]==1:T[A][B+1]=2
      if min(G)<B+1<max(G)and g[A][B+1]==0:T[A][B+1]=2
   for A in N(E):
    if A==e or A==o:
     for B in N(J,K+1):
      if T[A][B]==0:T[A][B]=2
   for B in N(D):
    if B==J or B==K:
     for A in N(e,o+1):
      if T[A][B]==0:T[A][B]=2
 E,D=L(g),L(g[0])
 for A in N(E):
  for B in N(D):
   if g[A][B]>0:T[A][B]=1
 return T