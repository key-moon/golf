def p(g):
	'Task 157 solution without frozenset.\n\n    - Finds connected components of non-zero cells (4-neighborhood).\n    - Optionally repositions non-largest components subject to constraints.\n    - Always returns a list-of-lists grid; maps 5 -> 0 in the working grid.\n    ';O=True;K=False;G,A=len(g),len(g[0]);H=[[K]*A for B in range(G)];L=[]
	for B in range(G):
		for C in range(A):
			if g[B][C]and not H[B][C]:
				M=[(B,C)];H[B][C]=O;D=set()
				while M:
					I,J=M.pop();D.add((I,J))
					for(Y,Z)in((1,0),(-1,0),(0,1),(0,-1)):
						E,F=I+Y,J+Z
						if 0<=E<G and 0<=F<A and not H[E][F]and g[E][F]:H[E][F]=O;M.append((E,F))
				L.append(D)
	if not L:return[[0 if A==5 else A for A in A]for A in g]
	a=sorted(L,key=len,reverse=O)[1:];N=[[0 if A==5 else A for A in A]for A in g]
	def P(color):return{(A,C)for(A,B)in enumerate(N)for(C,D)in enumerate(B)if D==color}
	Q=P(0);R=P(2)|{(A,-1)for A in(0,1,2)}|{(B,A)for B in(0,1,2)}
	for D in a:
		b=min(A for(A,B)in D);c=min(A for(B,A)in D);S={(A-b,B-c)for(A,B)in D}
		def T(pos):A,B=pos;return{(C+A,D+B)for(C,D)in S}
		def U(cells):return{(A+C,B+D)for(A,B)in cells for(C,D)in((0,1),(0,-1),(1,0),(-1,0))}
		def d(pos):return len(R&U(T(pos)))
		e={(B,C)for B in(1,2)for C in range(A)}
		def f(pos):
			A=T(pos)
			if not A.issubset(Q):return K
			if A&R:return K
			B=(Q&U(A))-A
			if not B:return K
			C=min(A for(A,B)in B);return C>2
		V=list(filter(f,e))
		if not V:continue
		I,J=max(V,key=d)
		for(B,C)in S:
			W,X=B+I,C+J
			if 0<=W<G and 0<=X<A:N[W][X]=1
	return N