def p(j,u=range):
	C=len(j);D=len(j[0]);B=len({*sum(j,[])}-{0});j=[[j[A//B][C//B]for C in u(D*B)]for A in u(C*B)];C*=B;D*=B
	for A in u(min(C,D),0,-1):
		for E in u(C-A+1):
			for F in u(D-A+1):
				I=j[E][F]
				if I and all(B[F:F+A]==[I]*A for B in j[E:E+A]):
					for(J,K)in((-1,-1),(-1,A),(A,-1),(A,A)):
						G=E+J;H=F+K
						while-1<G<C and-1<H<D and not j[G][H]:j[G][H]=2;G+=J>0 or-1;H+=K>0 or-1
					return j