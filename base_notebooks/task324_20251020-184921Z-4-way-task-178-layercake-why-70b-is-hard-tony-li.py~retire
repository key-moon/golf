def p(z):
	B=tuple(tuple(A)for A in z);E,F=len(B),len(B[0]);Q=[[False]*F for A in range(E)];K=[]
	def W(i,e):
		for(C,D)in((1,0),(-1,0),(0,1),(0,-1)):
			A,B=i+C,e+D
			if 0<=A<E and 0<=B<F:yield(A,B)
	for G in range(E):
		for D in range(F):
			b=B[G][D];L=[(G,D)];c=set()
			while L:
				A,C=L.pop();c.add((A,C))
				for(R,S)in W(A,C):
					if not Q[R][S]and B[R][S]==b:Q[R][S]=True;L.append((R,S))
			K.append((b,c))
	d=[(B,A)for(B,A)in K if len(A)==1];T=[(B,A)for(B,A)in K if len(A)>1]
	if not T:return[list(A)for A in B]
	M={}
	for(A,X)in T:M[A]=M.get(A,0)+len(X)
	N=sorted(M.items(),key=lambda x:(-x[1],x[0]))
	if not N:return[list(A)for A in B]
	Y=N[0][0];Z=N[1][0]if len(N)>1 else N[0][0];f={(A,C)for A in range(E)for C in range(F)if B[A][C]==Y};L={(A,C)for A in range(E)for C in range(F)if B[A][C]==Z};K=[(1,1),(-1,-1),(1,-1),(-1,1)]
	def M(i,e,di,g):
		C=[];A,B=i,e
		while 0<=A<E and 0<=B<F:C.append((A,B));A+=di;B+=g
		return C
	H=[(A,B)for(A,B)in d if A not in(Y,Z)]
	if not H:H=d[:]
	a=set()
	for(Q,X)in H:
		A,g=next(iter(X))
		for(D,W)in K:a.update(M(A,g,D,W))
	T=a&f;h=a&L
	if H:
		C={}
		for(A,Q)in H:C[A]=C.get(A,0)+1
		A=sorted(C.keys(),key=lambda r:(-C[r],r))
		if len(A)==1:A=A+[A[0]]
		I,J=A[0],A[1]
		def e(mc):
			C=D=0
			for(A,L)in H:
				if A!=mc:continue
				M,N=next(iter(L))
				for G in(-1,0,1):
					for I in(-1,0,1):
						if G==0 and I==0:continue
						A,J=M+G,N+I
						if 0<=A<E and 0<=J<F:
							K=B[A][J]
							if K==Y:C+=1
							elif K==Z:D+=1
			return C-D
		U=e(I);V=e(J)
		if U>0 and V<0:O,P=I,J
		elif U<0 and V>0:O,P=J,I
		elif U==0 and V!=0:
			if V>0:O,P=J,I
			else:O,P=I,J
			if U>0:O,P=I,J
	else:return[list(A)for A in B]
	C=[list(A)for A in B]
	for(G,D)in T:C[G][D]=O
	for(G,D)in h:C[G][D]=P
	return C