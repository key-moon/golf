  <!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}ARC-AGI Golf{% endblock %}</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <style>
    :root{ --header-h: 44px }
    body{padding:0; margin:0}
    header{ position: sticky; top: 0; z-index: 100; backdrop-filter: blur(4px); background: var(--pico-card-background-color); border-bottom:1px solid var(--pico-muted-border-color, #eee); height: var(--header-h); display:flex; align-items:center }
    header nav{ width:100%; display:flex; justify-content:space-between; align-items:center; gap:8px }
    header nav ul{ margin:0; padding:0 8px; display:flex; gap:8px; align-items:center }
    header .legend{ font-size: 12px }
    /* center the header legend vertically */
    #global-legend{ display:flex; align-items:center; height: var(--header-h); }
    main.container{ margin-top: calc(var(--header-h) + 8px); padding:8px }
    .grid{display:grid; gap:12px}
    .grid.cols-2{grid-template-columns: repeat(2, minmax(0,1fr))}
    .grid.cols-4{grid-template-columns: repeat(4, minmax(0,1fr))}
    .grid.cols-6{grid-template-columns: repeat(6, minmax(0,1fr))}
    .thumb{border:1px solid var(--pico-muted-border-color, #ddd); border-radius:6px; padding:8px; background: var(--pico-card-background-color); display:flex; flex-direction:column; gap:6px; height:auto; overflow:hidden}
    .legend{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .legend .box{width:14px; height:14px; display:inline-block; border:1px solid #999}
    canvas{image-rendering: pixelated}
    /* generic matrix cells (used across pages) */
    .mat{display:grid; gap:1px}
    .mat .cell{width:12px; height:12px; border: 1px solid rgba(0,0,0,0.1)}
    /* case grid wrapper */
    .case-grid{display:inline-grid; grid-auto-flow:row; grid-template-columns: auto auto; gap:4px; border:1px solid var(--pico-muted-border-color, #ccc); padding:4px}
    .muted{opacity:0.8}
    /* Slim segmented button group */
    .seg{display:inline-flex; border:1px solid var(--pico-muted-border-color, #ccc); border-radius:6px; overflow:hidden; background: var(--pico-muted-background, transparent)}
    .seg > button{border:0; margin:0; border-right:1px solid var(--pico-muted-border-color, #ccc); padding:4px 8px; line-height:1.1; height:28px; background: transparent; color: inherit}
    .seg > button:last-child{border-right:0}
    .seg > button.contrast{background: var(--pico-primary); color: var(--pico-primary-inverse, #fff)}
    /* Chip (for tags) */
    .chip{ display:inline-flex; align-items:center; gap:8px; padding:4px 12px; height:28px; line-height:1; font-size:17px; border-radius:999px; border:1px solid var(--pico-muted-border-color, #ccc); background: var(--pico-muted-background, transparent); color: inherit }
    .chip.contrast{ background: var(--pico-primary); color: var(--pico-primary-inverse, #fff); border-color: var(--pico-primary) }
    .chip:hover{ filter: brightness(0.98) }
    /* Alerts (bootstrap-like) */
    .alerts{ position: fixed; top: calc(var(--header-h) + 8px); right: 16px; display: flex; flex-direction: column; gap: 8px; z-index: 250 }
    .alert{ display:flex; align-items:flex-start; gap:8px; padding:8px 12px; border-radius:8px; border:1px solid var(--pico-muted-border-color, #ccc); background: var(--pico-muted-background, #f7f7f7); color: inherit; box-shadow: 0 2px 6px rgba(0,0,0,0.08) }
    .alert.success{ border-color:#2ecc71; background: rgba(46,204,113,0.12) }
    .alert.info{ border-color:#3498db; background: rgba(52,152,219,0.12) }
    .alert.error{ border-color:#e74c3c; background: rgba(231,76,60,0.12) }
    .alert .close{ margin-left:auto; background:transparent; border:0; cursor:pointer; line-height:1; padding:0 4px; font-size:18px }
    /* Slim button helper */
    .btn-slim{ padding:4px 10px !important; height:28px !important; line-height:1.1 !important; font-size:13px !important }
    .nowrap{white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
  </style>
</head>
<body>
  <header class="container-fluid">
    <nav>
      <ul>
        <li><strong><a href="/">ARC-AGI Golf</a></strong></li>
        <!-- Dashboard link removed -->
        <li><a href="/tasks">Tasks</a></li>
      </ul>
      <ul>
        <li>
          <div id="global-legend" class="legend"></div>
        </li>
        <li><a href="https://www.kaggle.com/competitions/arc-agi" target="_blank" class="muted">Kaggle</a></li>
      </ul>
    </nav>
  </header>
  <div id="alerts" class="alerts"></div>
  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <dialog id="modal">
    <article style="max-height:90vh; overflow:auto">
      <a href="#" aria-label="Close" class="close" onclick="document.getElementById('modal').close()"></a>
      <div id="modal-body"></div>
    </article>
  </dialog>
  <script>
    const GLOBAL_PALETTE=['#8B00FF','#4B0082','#0000FF','#FFFF00','#00FF00','#FF7F00','#FF0000','#964B00','#000000','#FFFFFF'];
    function buildGlobalLegend(){
      const root=document.getElementById('global-legend'); if(!root) return; root.textContent='';
      GLOBAL_PALETTE.forEach((col,i)=>{ const wrap=document.createElement('span'); wrap.style.display='inline-flex'; wrap.style.alignItems='center'; wrap.style.gap='4px'; wrap.appendChild(document.createTextNode(`${i}: `)); const box=document.createElement('span'); box.className='box'; box.style.background=col; wrap.appendChild(box); root.appendChild(wrap); });
    }
    buildGlobalLegend();
    window.showModal = (htmlOrNode)=>{
      const dlg = document.getElementById('modal');
      const body = document.getElementById('modal-body');
      body.innerHTML = '';
      if(typeof htmlOrNode === 'string') body.innerHTML = htmlOrNode; else body.appendChild(htmlOrNode);
      dlg.showModal();
    };
    // Bootstrap-like alerts
    window.showAlert = (message, kind = 'info', timeout = 3000)=>{
      const host = document.getElementById('alerts');
      if(!host) return;
      const el = document.createElement('div');
      el.className = `alert ${kind}`;
      el.innerHTML = `<div>${message}</div>`;
      const close = document.createElement('button'); close.className='close'; close.setAttribute('aria-label','Close'); close.innerHTML='&times;'; close.onclick=()=>{ el.remove(); };
      el.appendChild(close);
      host.appendChild(el);
      if(timeout>0){ setTimeout(()=>{ el.remove(); }, timeout); }
      return el;
    };
    // Navigate to tasks filtered by a tag (supports special characters)
    window.openTasksWithTag = (tag)=>{
      const params = new URLSearchParams(location.search);
      // normalize: drop any legacy comma-based single value
      const legacy = params.get('tags');
      if(legacy && !params.getAll('tags').length){
        params.delete('tags');
        legacy.split(',').map(s=>s.trim()).filter(Boolean).forEach(t=> params.append('tags', t));
      }
      // append this tag if not present
      const existing = new Set(params.getAll('tags'));
      if(!existing.has(tag)) params.append('tags', tag);
      // ensure at least sort=best to be consistent with UX
      if(!params.get('sort')) params.set('sort','best');
      location.href = `/tasks?${params.toString()}`;
    };
    // Global go-to-task shortcut: press 'g' to jump to a task id
    document.addEventListener('keydown', (e)=>{
      if(e.key !== 'g' || e.ctrlKey || e.metaKey || e.altKey) return;
      const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : '';
      if(tag === 'input' || tag === 'textarea' || (e.target && e.target.isContentEditable)) return;
      const v = prompt('Go to task number (1-400)');
      if(!v) return;
      const id = parseInt(v, 10);
      if(Number.isFinite(id) && id>=1 && id<=400){ location.href = `/tasks/${id}`; }
    });
  </script>
</body>
</html>
